<div class="char-wrap">
  <div class="new_project_cont"><span>New Project >&nbsp; </span>
    <p> {{projectname}}</p>
  </div>
  <div class="chat-container" #scrollMe [scrollTop]="scrollMe.scrollHeight">

    <div *ngFor="let msg of messages(); let i = index; trackBy: trackByMsg;"
      [ngClass]="{ 'bot': msg.from === 'bot', 'user': msg.from === 'user' }" class="message">
      <div class="bubble">
        <ng-container *ngIf="msg.text.startsWith('typing'); else normalText">
          <div class="typing-indicator">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
        </ng-container>
        <ng-template #normalText>{{ msg.text }}</ng-template>
       
<ng-container *ngIf="msg.upload_file === 0">
<div [ngClass]="{ 'Options_list': msg.upload_file === 0 }">
          <div *ngFor="let option of msg.options; let j = index" class="option"
            (click)="handleOptionSelect(option)"
            >
            {{ option }}
          </div>
          </div>
</ng-container>
<ng-container *ngIf="msg.upload_file === 1">
<div class="file-upload">
  <div style="display: flex;">
    <div class="file-list" >
       <div>Listed File</div>
       <div class="file-ul">
          <div *ngFor="let item of msg.options; let j = index" class="file-item_wrap"
            (click)="file_upload()"
            >
            <div class="file-info">
           <span class="file-name"> {{ item.display_text }}</span>
          </div>
          </div>
       </div>
        </div>
        <div class="file-list" *ngIf="files.length > 0">
  <div>Uploaded File</div>

  <div cdkDropList (cdkDropListDropped)="drop($event)" class="file-ul">
  <div *ngFor="let file of files; let i = index" cdkDrag class="file-item_wrap" 
    (cdkDragStarted)="isDragging = true" (cdkDragEnded)="isDragging = false"
    [ngClass]="{'failed': fileStatus[file.name]?.status === 'failed'}">
      
    <div
  class="file-info" [ngClass]="{
    'uploading': fileStatus[file.name]?.status === 'uploading',
    'success': fileStatus[file.name]?.status === 'success',
    'failed': fileStatus[file.name]?.status === 'failed'
  }">
  <span class="file-name">{{ file.name }}</span>
  
      <div class="status-indicator">
  <ng-container *ngIf="fileStatus[file.name]?.status === 'uploading'" >
      <!-- <span>Uploading...</span> -->
      <div class="progress-bar" [hidden]="isDragging"></div>
</ng-container>

    <ng-container *ngIf="fileStatus[file.name]?.status === 'success'">
      <!-- <div class="progress-bar" [hidden]="isDragging"></div> -->
      <span class="status">Uploaded</span>
    </ng-container>

    <ng-container *ngIf="fileStatus[file.name]?.status === 'failed'">
      <!-- <div class="progress-bar" [hidden]="isDragging"></div> -->
      <span class="status">Failed </span>
    </ng-container>
  </div>

  <!-- <div *ngIf="fileStatus[file.name]?.reason" class="error-message">
    {{ fileStatus[file.name].reason }}
  </div> -->
</div>
 <div class="file-actions_vew">
      <ng-container *ngIf="fileStatus[file.name]?.status !== 'success'; else downloadBtn">
  <!-- Replace Button -->
  <button
    mat-button
    class="action-btn white-icon"
    (click)="openReplace(i)"
  >
    <mat-icon>sync</mat-icon>
    Replace
  </button>

  <!-- Re-upload Button (only on failure) -->
  <button
    mat-button
    class="action-btn white-icon"
    *ngIf="fileStatus[file.name]?.status === 'failed'"
    (click)="reuploadFile(i)"
  >
    <mat-icon>refresh</mat-icon>
    Re-upload
  </button>
</ng-container>

<ng-template #downloadBtn>
  <button
    mat-button
    class="action-btn blue-download"
    (click)="downloadExcel(i)"
  >
    <mat-icon>download</mat-icon>
    Download Excel
  </button>
</ng-template>


    </div>

    
  </div>
</div>
</div>
          </div>
          <div
            class="drop-zone"
            (drop)="!allFilesUploaded && onFileDropped($event)"
            (dragover)="!allFilesUploaded && onDragOver($event)"
            [class.disabled]="allFilesUploaded"
          >
            <!-- <p>ðŸ“‚ Drag & Drop Excel files here</p>
            <p>or</p> -->
            <button (click)="fileInput.click()" [disabled]="allFilesUploaded">
              <img src="../../assets/images/upload_file.png" alt="Upload Icon" />
            </button>
            <input
              #fileInput
              type="file"
              multiple
              accept=".xls,.xlsx"
              (change)="onFileBrowse($event)"
              [disabled]="allFilesUploaded"
              hidden
            />
  <!-- Hidden input used to replace a specific file -->
  <input id="replaceInput" type="file" accept=".xls,.xlsx" (change)="onReplaceSelected($event)" hidden />
</div>



<button (click)="uploadAll()" [disabled]="allFilesUploaded">
  ðŸš€ Upload All
</button>

          </div>
</ng-container>


        
      </div>
    </div>
  </div>
  <!-- <div class="search" fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="0px">
    <div class="glob" fxLayout="column">
      <img src="../../../assets/images/Frame 54.png" />
    </div>

    <div fxFlex appearance="fill">
      <div class="custom-input">
        <mat-form-field appearance="fill">
          <mat-label>Search</mat-label>
          <input matInput placeholder="Search..." [(ngModel)]="searchText" (keydown.enter)="sendUserMessage()" />
        </mat-form-field>
      </div>
    </div>

    <div fxLayout="column" class="send_btn" (click)="sendUserMessage()">
      <img src="../../../assets/images/Group.png" />
    </div>
  </div> -->
</div>